---
import Layout from '../../../layouts/Layout.astro';
import PostCard from '../../../components/PostCard.astro';
import CategoryList from '../../../components/CategoryList.astro';
import TagCloud from '../../../components/TagCloud.astro';
import SearchBar from '../../../components/SearchBar';
import Pagination from '../../../components/Pagination.astro';
import { getPosts } from '../../../lib/supabase';

export async function getStaticPaths({ paginate }) {
  // 获取所有文章
  const { data: posts, count } = await getPosts(100, 0);
  
  // 使用 paginate 函数生成分页路由
  return paginate(posts || [], { pageSize: 9 });
}

const { page } = Astro.props;
const currentPage = page.currentPage;
const totalPages = page.lastPage;
---

<Layout 
  title={`博客文章 - 第 ${currentPage} 页 | YourBlog`}
  description={`浏览博客文章列表的第 ${currentPage} 页，了解最新的技术、编程和生活分享。`}
>
  <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="flex flex-col md:flex-row gap-8">
      <!-- 主内容区 -->
      <div class="md:w-2/3">
        <div class="mb-8">
          <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-4">博客文章</h1>
          <p class="text-gray-600 dark:text-gray-400">
            探索我的最新文章、教程和见解。
          </p>
        </div>
        
        <!-- 搜索栏 -->
        <div class="mb-8">
          <SearchBar client:load />
        </div>
        
        {page.data.length > 0 ? (
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {page.data.map(post => (
              <PostCard post={post} />
            ))}
          </div>
        ) : (
          <div class="text-center py-12 text-gray-500 dark:text-gray-400">
            暂无文章
          </div>
        )}
        
        <!-- 分页 -->
        <Pagination currentPage={currentPage} totalPages={totalPages} baseUrl="/blog/page" />
      </div>
      
      <!-- 侧边栏 -->
      <div class="md:w-1/3 space-y-8">
        <CategoryList />
        <TagCloud />
        
        <!-- 订阅区域 -->
        <div class="bg-white dark:bg-gray-900 rounded-lg shadow-md p-6 border border-gray-200 dark:border-gray-800">
          <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">订阅更新</h3>
          <p class="text-gray-600 dark:text-gray-400 mb-4">
            订阅我的博客，获取最新文章和更新。
          </p>
          <form class="space-y-3">
            <input 
              type="email" 
              placeholder="您的邮箱地址" 
              class="w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary-500"
              required
            />
            <button 
              type="submit" 
              class="w-full px-4 py-2 bg-primary-600 text-white font-medium rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
            >
              订阅
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</Layout>